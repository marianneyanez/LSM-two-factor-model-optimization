# LSM-two-factor-model-optimization
Least-Squares MonteCarlo algorithm that solves a sequential decision-making problem to determine the optimal switch time between primary and secondary hydrocarbon recovery, using a simple production and economic model
The methodology starts by defining the number of paths (individual realizations) of the uncertain variables, and the number of time steps. Following the recommendation from Wui (2019), 10,000 paths were defined, being a suitable sample size for an accurate assessment of the value of information (VOI). The number of time steps was kept the same as that in Wui (2019) work, with a maximum production lifetime of 50 years, where each year is an observation and decision point. After this definition  the approach continues with the forward simulation of the uncertain variables over all the paths; this consisted in a multi-variate Monte Carlo simulation over five model parameters, as per truncated normal distributions and correlation coefficients defined in Table 14 and Table 15:
Original oil in place (OOIP)
Theoretical ultimate recovery factor for primary production (〖E_R1〗^∞)
Theoretical ultimate increment of secondary recovery factor (Δ〖E_R2〗^∞)
Time constant for primary production (τ1 )
Time constant for secondary production (τ2 )
These model parameters enabled the calculation of the oil rates at each time step of the production lifetime, using Equation (14). Measurement error was accounted for by performing Monte Carlo simulation of a normal distribution where the means were the calculated oil rates, and then standard deviations were 10% of these calculated values, as per Equation (15). This new sample set is considered the “observed” oil rates and the ones used for regression.
The corresponding cash flows were also calculated for each time step and combination of primary recovery and secondary recovery lifetimes (Equation (16)), followed by the NPV calculation (Equation  (17)). Then, using the exponential utility function (Equation  (18)) the NPVs were converted to utilities. A preliminary risk tolerance of MM$ 200 was used. A sensitivity analysis of risk tolerance will be performed later.
The identification of the optimal decision policy was split into two phases:
	Determining the optimal stopping time of secondary recovery, given a switch from primary production at each year, for a given path.
	Determining the optimal switch time, from primary to secondary recovery, with secondary recovery’s corresponding optimal stopping time determined in the previous step, for a given path.
To incorporate the ‘learnings over time’, the decision-making process starts at year 50, and recursively progress backwards in time in a rollback procedure. Two timing indexes are created to represent the switch from primary to secondary recovery at each year, and the possible stopping times of the secondary recovery at each of those years. For each decision point, all the oil rates from year 1 to the assessment year are used, and also the utilities corresponding to that assessment year. To exercise the decision policy, the expected utilities (EU) from the available options (explained next) are compared at each decision point. As described in the LSM method, the EU are estimated by using non-linear multi-dimensional regression (using the chosen XGB algorithm) where the X is the oil rates and the Y is the EU from each option. 
